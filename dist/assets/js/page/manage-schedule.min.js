var inputs,data={};function addDatePicker(){var t=new Date,e=$.extend({},$.datepicker.regional.ja,{changeMonth:!0,changeYear:!0,minDate:t,dateFormat:"yy/mm/dd"});$("body").on("focus",".js-datepicker",function(){$(this).datepicker(e)})}function addSchedule(){$("body").on("click",".js-edit-row",function(){fields=$(this).closest(".js-row").find("input, textarea, select").not(".restrict"),$(this).is(".editing")?($(this).text("修正する"),$(this).removeClass("editing"),fields.prop("disabled",!0),$(".js-form-schedule").trigger("submit")):($(this).text("セーブする"),$(this).addClass("editing"),fields.prop("disabled",!1))}),$(".js-form-schedule").on("submit",function(){if(data={},!$(this).is(".creating"))return(inputs=$(".js-lst-schedule").find("input, textarea, select")).each(function(t,e){var n=$(this).attr("name"),a=$(this).val();"schedule"==n?data.schedule=parseInt(a)-1:data[n]=a}),$.ajax({method:"POST",dataType:"json",data:data}).success(function(t){}).error(function(t,e,n){console.log(t+e+n)}),!1;(inputs=$(this).find("input, textarea, select")).each(function(t,e){var n=$(this).attr("name"),a=$(this).val();data[n]=a})})}function deleteRow(){$("body").on("click",".js-delete-row",function(){var t=$(".js-rp .js-row").length+1,e=$(this).closest(".js-row").attr("data-row");$(this).closest(".js-row").remove(),$(".js-val-row-delete").attr("value",e),$(".js-number-rp").attr("value",t-1);var n=0;$(".js-rp .js-row").each(function(){var t=$(this).attr("data-row");$(this).attr("data-row",n),$(this).find("input, textarea, select").each(function(){name_input=$(this).attr("name"),new_name_input=name_input.replace("_"+t+"_","_"+n+"_"),id_input=$(this).attr("id"),new_id_input=id_input.replace("_"+t,"_"+n),$(this).attr("name",new_name_input),$(this).attr("id",new_id_input)}),n++}),$(".js-new-post").each(function(){var t=$(this).attr("data-row");$(this).attr("data-row",n),$(this).find("input, textarea, select").each(function(){name_input=$(this).attr("name"),new_name_input=name_input.replace("_"+t+"_","_"+n+"_"),id_input=$(this).attr("id"),new_id_input=id_input.replace("_"+t,"_"+n),$(this).attr("name",new_name_input),$(this).attr("id",new_id_input)}),n++}),setTimeout(function(){$(".js-form-schedule").trigger("submit")},200)})}function addNewSchedule(){$(".js-create-select").on("change",function(){var t=$("option:selected",this),e=(t.attr("data-id"),t.attr("data-ttl"),t.attr("data-content")),n=t.attr("data-level"),a=$(".js-lesson-content"),i=$(".js-lesson-level");a.html("").append($.parseHTML(e)),i.find("option[value="+n+"]").prop("selected",!0)});var t,e,n=$(".js-rp .js-row").length;$(".js-number-rp").attr("value",n+1),$(".js-new-post").attr("data-row",n),$(".js-new-post").find("input, textarea, select").each(function(){t=$(this).attr("name"),new_name_input=t.replace("_0_","_"+n+"_"),e=$(this).attr("id"),new_id_input=e.replace("_0","_"+n),$(this).attr("name",new_name_input),$(this).attr("id",new_id_input)}),$("body").on("click",".js-add-new",function(){$(".js-form-schedule").addClass("creating"),setTimeout(function(){$(".js-form-schedule").trigger("submit")},200)})}function yearMonthFilter(){var i=getUrlParameter("ym");void 0!==i&&(console.log(i),$(".js-rp .js-row").find(".js-datepicker").each(function(){var t=$(this).val(),e=new Date(t),n=(e.getDate(),e.getMonth()+1),a=e.getFullYear();i!=a+"/"+n&&$(this).closest(".js-row").hide()}))}function selectRedirect(){$(".js-select-redirect").on("change",function(){var t=$(this).val();return t&&(window.location=t),!1})}$(document).ready(function(){addDatePicker(),addSchedule(),deleteRow(),addNewSchedule(),yearMonthFilter(),selectRedirect(),validateCreate()});var getUrlParameter=function(t){var e,n,a=window.location.search.substring(1).split("&");for(n=0;n<a.length;n++)if((e=a[n].split("="))[0]===t)return void 0===e[1]||decodeURIComponent(e[1])};function validateCreate(){$(".js-start-time").on("change",function(){var t=$(this)[0].selectedIndex;(""==$(".js-end-time").val()||$(".js-end-time")[0].selectedIndex<=t)&&$(".js-end-time option:nth-child("+(t+2)+")").prop("selected","true"),$(".js-end-time option").each(function(){$(this).index()<=t?$(this).prop("disabled","true"):$(this).removeAttr("disabled")})})}