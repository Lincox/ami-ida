var inputs,data={};function addDatePicker(){var t=new Date,e=$.extend({},$.datepicker.regional.ja,{changeMonth:!0,changeYear:!0,minDate:t,dateFormat:"yy/mm/dd"});$("body").on("focus",".js-datepicker",function(){$(this).datepicker(e)})}function addSchedule(){$("body").on("click",".js-edit-row",function(){fields=$(this).closest(".js-row").find("input, textarea, select").not(".restrict"),$(this).is(".editing")?($(this).text("修正する"),$(this).removeClass("editing"),fields.prop("disabled",!0),$(".js-form-schedule").trigger("submit")):($(this).text("セーブする"),$(this).addClass("editing"),fields.prop("disabled",!1))}),$(".js-form-schedule").on("submit",function(){if(data={},!$(this).is(".creating"))return(inputs=$(".js-lst-schedule").find("input, textarea, select")).each(function(t,e){var a=$(this).attr("name"),n=$(this).val();"schedule"==a?data.schedule=parseInt(n)-1:data[a]=n}),$.ajax({method:"POST",dataType:"json",data:data}).success(function(t){}).error(function(t,e,a){console.log(t+e+a)}),!1;(inputs=$(this).find("input, textarea, select")).each(function(t,e){var a=$(this).attr("name"),n=$(this).val();data[a]=n})})}function deleteRow(){$("body").on("click",".js-delete-row",function(){var t=$(".js-rp .js-row").length+1,e=$(this).closest(".js-row").attr("data-row");$(this).closest(".js-row").remove(),$(".js-val-row-delete").attr("value",e),$(".js-number-rp").attr("value",t-1);var a=0;$(".js-rp .js-row").each(function(){var t=$(this).attr("data-row");$(this).attr("data-row",a),$(this).find("input, textarea, select").each(function(){name_input=$(this).attr("name"),new_name_input=name_input.replace("_"+t+"_","_"+a+"_"),id_input=$(this).attr("id"),new_id_input=id_input.replace("_"+t,"_"+a),$(this).attr("name",new_name_input),$(this).attr("id",new_id_input)}),a++}),$(".js-new-post").each(function(){var t=$(this).attr("data-row");$(this).attr("data-row",a),$(this).find("input, textarea, select").each(function(){name_input=$(this).attr("name"),new_name_input=name_input.replace("_"+t+"_","_"+a+"_"),id_input=$(this).attr("id"),new_id_input=id_input.replace("_"+t,"_"+a),$(this).attr("name",new_name_input),$(this).attr("id",new_id_input)}),a++}),setTimeout(function(){$(".js-form-schedule").trigger("submit")},200)})}function addNewSchedule(){var s=["★","★★","★★★","★★★★","★★★★★"];$(".js-create-select").on("change",function(){var t=$("option:selected",this),e=(t.attr("data-id"),t.attr("data-ttl"),t.attr("data-content")),a=t.attr("data-level"),n=$(".js-lesson-content"),i=$(".js-lesson-level");n.html("").append($.parseHTML(e)),i.text(s[parseInt(a)-1])});var t,e,a=$(".js-rp .js-row").length;$(".js-number-rp").attr("value",a+1),$(".js-new-post").attr("data-row",a),$(".js-new-post").find("input, textarea, select").each(function(){t=$(this).attr("name"),new_name_input=t.replace("_0_","_"+a+"_"),e=$(this).attr("id"),new_id_input=e.replace("_0","_"+a),$(this).attr("name",new_name_input),$(this).attr("id",new_id_input)}),$("body").on("click",".js-add-new",function(){$(".js-form-schedule").addClass("creating"),setTimeout(function(){$(".js-form-schedule").trigger("submit")},200)})}function yearMonthFilter(){var i=getUrlParameter("ym");void 0!==i&&(console.log(i),$(".js-rp .js-row").find(".js-datepicker").each(function(){var t=$(this).val(),e=new Date(t),a=(e.getDate(),e.getMonth()+1),n=e.getFullYear();i!=n+"/"+a&&$(this).closest(".js-row").hide()}))}function selectRedirect(){$(".js-select-redirect").on("change",function(){var t=$(this).val();return t&&(window.location=t),!1})}$(document).ready(function(){addDatePicker(),addSchedule(),deleteRow(),addNewSchedule(),yearMonthFilter(),selectRedirect(),validateCreate()});var getUrlParameter=function(t){var e,a,n=window.location.search.substring(1).split("&");for(a=0;a<n.length;a++)if((e=n[a].split("="))[0]===t)return void 0===e[1]||decodeURIComponent(e[1])};function validateCreate(){$(".js-start-time").on("change",function(){var t=$(this)[0].selectedIndex;(""==$(".js-end-time").val()||$(".js-end-time")[0].selectedIndex<=t)&&$(".js-end-time option:nth-child("+(t+2)+")").prop("selected","true"),$(".js-end-time option").each(function(){$(this).index()<=t?$(this).prop("disabled","true"):$(this).removeAttr("disabled")})})}